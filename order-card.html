<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Card</title>
    <link rel="stylesheet" href="styles/order-card.css">
    <link rel="stylesheet" href="styles/index.css">
    <link rel="icon" href="assets/logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@200..800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">




    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        /* Dark input border when focused */
        .form-control:focus,
        textarea.form-control:focus {
            border-color: #212529 !important;
            /* Bootstrap dark */
            box-shadow: 0 0 0 0.2rem rgba(33, 37, 41, 0.25) !important;
        }

        /* Dark button instead of primary (blue) */
        .btn-primary {
            background-color: #212529 !important;
            /* Bootstrap's dark color */
            border-color: #212529 !important;
        }

        .btn-primary:hover {
            background-color: #343a40 !important;
            border-color: #343a40 !important;
        }

        .btn-primary:active {
            background-color: #1d2124 !important;
            border-color: #1d2124 !important;
        }
    </style>
</head>

<body>
    <section id="hero-sec">


        <div class="navigation">
            <!-- Logo -->
            <div class="logo">
                <img src="./assets/logo.png" alt="logo">
            </div>

            <!-- Navbar -->
            <div class="navbar">
                <img src="assets/menu.png" alt="menu" class="menu" id="menu" onclick="toggleMenu()">
                <ul id="menuList">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="shop.html">Shop</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="shipping_policy.html">Shipping Policy</a></li>
                    <li><a href="refund_policy.html">Refund Policy</a></li>
                </ul>
            </div>

        </div>
    </section>


    <!-- Order Now Card -->
    <div class="product-card">
        <div class="product-image">
            <img id="product-img" src="" alt="" />
        </div>
        <div class="product-details">
            <p class="stock-alert">üî• Hurry Up! Only limited stock available!</p>
            <h2 id="product-name" class="product-name"></h2>
            <p id="old-price" class="old-price"></p>
            <p id="new-price" class="new-price"></p>
            <span id="badge" class="badge"></span>
            <div class="rating">‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è 1 review</div>

            <div class="good-news">
                <p><span>Good News for Our Customers!</span> You can open your parcel before making the payment.</p>
            </div>
            <button class="order-btn" id="order-btn" data-bs-toggle="modal" data-bs-target="#orderModal">üõí Order Now ‚Äì
                Cash on Delivery</button>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content shadow-lg border-0 rounded-4">
                <div class="modal-header bg-dark text-white rounded-top-4">
                    <h5 class="modal-title" id="orderModalLabel">Complete Your Order</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>

                <div class="modal-body p-4">
                    <form id="orderForm">
                        <div class="mb-3">
                            <label for="name" class="form-label fw-semibold">Full Name</label>
                            <input type="text" class="form-control rounded-3" id="name" required>
                        </div>

                        <div class="mb-3">
                            <label for="contact" class="form-label fw-semibold">Contact Number</label>
                            <input type="tel" class="form-control rounded-3" id="contact" required>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label fw-semibold">Email Address</label>
                            <input type="email" class="form-control rounded-3" id="email" required>
                        </div>

                        <div class="mb-3">
                            <label for="address" class="form-label fw-semibold">Shipping Address</label>
                            <textarea class="form-control rounded-3" id="address" rows="2" required></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="city" class="form-label fw-semibold">City</label>
                            <input type="text" class="form-control rounded-3" id="city" required>
                        </div>

                        <button type="submit" class="btn btn-success w-100 rounded-3 fw-semibold">
                            Buy It Now (Cash on Delivery)
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- Toast Container -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055">
        <div id="orderToast" class="toast align-items-center text-bg-success border-0" role="alert"
            aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body fw-semibold">
                    üéâ Thank you! Your order was submitted successfully. For Any Query Feel Free to Contact on whatsapp
                    üòä
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    aria-label="Close"></button>
            </div>
        </div>
    </div>



    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Include jQuery first -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        let lastScrollTop = 0;
        const navbar = document.querySelector(".navigation");

        window.addEventListener("scroll", () => {
            let currentScroll = window.scrollY;

            if (currentScroll > lastScrollTop) {
                navbar.classList.add("navbar-hidden");
            } else {
                navbar.classList.remove("navbar-hidden");
            }

            lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
        });

        // üîß Load product data from localStorage correctly
        const product = JSON.parse(localStorage.getItem("selectedProduct"));

        if (product) {
            const imagePath = product.image || "default.jpg";
            const fullImageUrl = `${location.origin}/${imagePath}`;

            const imgElement = document.querySelector("#product-img");
            imgElement.src = fullImageUrl;
            imgElement.alt = product.name || "Product";

            // üÜï Open full image in new tab on click
            imgElement.style.cursor = "pointer";
            imgElement.addEventListener("click", () => {
                window.open(fullImageUrl, "_blank");
            });

            document.querySelector("#product-name").innerText = product.name || "Product Name";
            document.querySelector("#old-price").innerText = product.oldPrice || "";
            document.querySelector("#new-price").innerText = product.price || "";
            document.querySelector("#badge").innerText = product.brand || "";
        } else {
            console.warn("No product found in localStorage under 'selectedProduct'");
        }

        // üßæ Form submission handler
        const form = document.querySelector('#orderForm');

        form.addEventListener('submit', async function (e) {
            e.preventDefault();

            const name = document.querySelector('#name').value.trim();
            const contact = document.querySelector('#contact').value.trim();
            const email = document.querySelector('#email').value.trim();
            const address = document.querySelector('#address').value.trim();
            const city = document.querySelector('#city').value.trim();

            const storedProduct = localStorage.getItem('selectedProduct');
            let product = {};

            try {
                product = JSON.parse(storedProduct);
            } catch (err) {
                console.error('Error parsing product:', err);
            }

            const productName = product?.title || 'Unknown Product';
            const price = product?.price || 'N/A';
            const originalPrice = product?.originalPrice || 'N/A';
            const imageURL = `${location.origin}/${product?.image || 'N/A'}`;

            const message = `
                Name: ${name}
                Email: ${email}
                Contact Number: ${contact}
                Product Name: ${productName}
                Price: ${price} PKR
                Original Price: ${originalPrice} PKR
                Product Image URL: ${imageURL}
                Address: ${address}
                City: ${city}
                Order Time: ${new Date().toLocaleString()}
            `.trim();

            const formData = new FormData();
            formData.append('access_key', "6083e3f6-020c-4db3-bd66-44707beea28e");
            formData.append('name', name);
            formData.append('email', email);
            formData.append('message', message);

            try {
                const response = await fetch('https://api.web3forms.com/submit', {
                    method: 'POST',
                    body: formData,
                });

                const result = await response.json();

                if (result.success) {
                    const orderModal = bootstrap.Modal.getInstance(document.getElementById('orderModal'));
                    orderModal.hide();
                    const toast = new bootstrap.Toast(document.getElementById('orderToast'));
                    toast.show();
                    form.reset();
                } else {
                    alert('‚ùå Something went wrong. Try again.');
                }
            } catch (error) {
                console.error('Form submission failed:', error);
                alert('üö´ Network error. Please try again later.');
            }
        });

        // Toggle Menu
        function toggleMenu() {
            const menuIcon = document.getElementById('menu');
            const menuList = document.getElementById('menuList');
            const navigation = document.querySelector('.navigation');
            const navbarMenu = document.querySelector('.navigation .navbar ul');

            menuList.classList.toggle('show');

            if (menuList.classList.contains('show')) {
                menuIcon.src = 'assets/close.png';
                navigation.style.height = '48vh';
                navbarMenu.style.display = 'block';
            } else {
                menuIcon.src = 'assets/menu.png';
                navigation.style.height = '';
                navbarMenu.style.display = 'none';
            }
        }
    </script>




    <script src="js/order-card.js"></script>
</body>

</html>